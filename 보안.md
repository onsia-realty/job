# 부동산인 BOOIN - 보안 적용 현황

> 최종 업데이트: 2026-02-07
> Round 1 커밋: `1e1bb5b` | Round 2: OpenAI 분석 기반 보안 강화

---

## 보안 적용 배경

경쟁사가 브라우저 개발자 도구(F12)를 통해 프론트엔드 코드를 분석하고 UI/UX, 가격 정책, 비즈니스 로직을 그대로 복제하는 위협에 대응하기 위해 보안 레이어를 적용함.

---

## 이전 vs 현재 비교

### 적용 전 (취약 상태)

| 항목 | 상태 | 위험도 |
|------|------|--------|
| Source Map (.map 파일) | 프로덕션에서 노출 | **치명** - 원본 TypeScript 코드가 그대로 보임 |
| 우클릭 → 소스 보기 | 가능 | **높음** - HTML 구조 즉시 파악 가능 |
| F12 개발자 도구 | 자유롭게 사용 | **높음** - JS/CSS/네트워크 전부 분석 가능 |
| Ctrl+U 소스 보기 | 가능 | **높음** - 페이지 전체 HTML 노출 |
| 텍스트 드래그/복사 | 가능 | **중간** - 콘텐츠 즉시 복사 가능 |
| Console 로그 | 전부 노출 | **중간** - 내부 동작 로직 추적 가능 |
| curl/스크래퍼 접근 | 차단 없음 | **높음** - 자동화 도구로 전체 페이지 수집 가능 |
| 보안 헤더 | 없음 | **높음** - XSS, iframe 삽입 등 공격에 노출 |
| Rate Limiting | 없음 | **중간** - 무제한 요청으로 데이터 크롤링 가능 |
| robots.txt | 없음 | **중간** - 모든 크롤러가 전체 사이트 인덱싱 |

### 적용 후 - Round 1 (기본 보안)

| 항목 | 상태 | 방어 수준 |
|------|------|-----------|
| Source Map | 프로덕션 비활성화 + .map 접근 시 404 | **완전 차단** |
| 우클릭 | contextmenu 이벤트 차단 | **차단** |
| F12 / Ctrl+Shift+I/J/C | 키보드 이벤트 차단 + DevTools 감지 | **차단 + 감지** |
| Ctrl+U 소스 보기 | 키보드 이벤트 차단 | **차단** |
| 텍스트 드래그/복사 | selectstart, copy, dragstart 차단 + CSS user-select:none | **차단** |
| Console 로그 | 프로덕션에서 20개 메서드 전부 무력화 | **완전 차단** |
| curl/스크래퍼 | User-Agent 기반 15개 패턴 차단 (403) | **차단** |
| 보안 헤더 | 7종 적용 (XSS, iframe, HSTS, CSP 등) | **적용 완료** |
| Rate Limiting | IP당 분당 120회 초과 시 429 | **적용 완료** |
| robots.txt | AI 크롤러 + 소스 경로 차단 | **적용 완료** |
| debugger 트랩 | 3초 간격 debugger 실행, DevTools 열면 지연 감지 | **감지 + 경고** |

### 적용 후 - Round 2 (OpenAI 분석 기반 보안 강화)

> OpenAI의 보안 분석을 통해 식별된 취약점을 보완

| 항목 | 상태 | 방어 수준 | Round 1 대비 개선 |
|------|------|-----------|-------------------|
| Honeypot 트랩 | 숨겨진 링크 5개 → 봇만 클릭 → IP 영구 차단 | **신규 추가** | 행동 기반 봇 탐지 |
| Burst 감지 | 5초 내 20회 이상 요청 시 429 | **신규 추가** | UA 스푸핑 우회 대응 |
| 자동화 도구 감지 | WebDriver/Phantom/Headless 등 6가지 지표 | **신규 추가** | 브라우저 핑거프린팅 |
| Referer 검증 | 외부 origin에서 API 직접 호출 차단 | **신규 추가** | API 데이터 보호 |
| .env 파일 차단 | /.env, /.env.local 직접 접근 시 403 | **신규 추가** | 환경변수 보호 |
| debugger 트랩 | DevTools 감지 시에만 활성화 (성능 최적화) | **개선됨** | 일반 사용자 성능 영향 제거 |
| 텍스트 선택/복사 | input/textarea에서 허용 (UX 개선) | **개선됨** | 폼 입력 시 복사/붙여넣기 가능 |
| 함수 코드 은닉 | Function.prototype.toString 재정의 | **신규 추가** | 보안 함수 내부 로직 숨김 |
| 봇 UA 패턴 | 15개 → 21개로 확대 (crawl/spider/bot 추가) | **강화됨** | 더 넓은 범위 차단 |
| Honeypot IP 블랙리스트 | 트랩 접근 IP는 전체 사이트 404 | **신규 추가** | 영구 차단 메커니즘 |

---

## 경쟁사 차단 시나리오별 대응

### 시나리오 1: F12 눌러서 코드 분석

```
경쟁사 행동: F12 → Elements 탭에서 HTML 구조 확인 → Sources 탭에서 JS 코드 분석
```

**차단 내용:**
- F12 키 이벤트 자체를 `preventDefault()`로 차단
- Ctrl+Shift+I (개발자도구), Ctrl+Shift+J (콘솔), Ctrl+Shift+C (요소선택) 모두 차단
- DevTools가 열리면 창 크기 변화 감지 → 경고
- `debugger` 트랩이 3초마다 실행 → DevTools 열면 코드 실행이 계속 중단됨
- Source Map 제거로 원본 TypeScript 코드 접근 불가

### 시나리오 2: 우클릭 → 소스 보기

```
경쟁사 행동: 우클릭 → "페이지 소스 보기" 또는 "검사"
```

**차단 내용:**
- 우클릭(contextmenu) 이벤트 차단
- Ctrl+U (소스 보기) 키 이벤트 차단

### 시나리오 3: 텍스트/디자인 복사

```
경쟁사 행동: 가격 정보, 문구, 레이아웃을 드래그하여 복사
```

**차단 내용:**
- 텍스트 선택(selectstart) 차단
- 복사(copy) 이벤트 차단
- 드래그(dragstart) 차단
- CSS `user-select: none` 전역 적용
- Ctrl+S (페이지 저장) 차단

### 시나리오 4: 자동화 도구로 크롤링

```
경쟁사 행동: Python(requests/scrapy), curl, wget 등으로 페이지 자동 수집
```

**차단 내용:**
- User-Agent 기반 21개 패턴 차단:
  - `curl`, `wget`, `python-requests`, `scrapy`
  - `httpie`, `postman`, `insomnia`
  - `node-fetch`, `axios`, `go-http-client`
  - `java/`, `libwww-perl`, `php/`, `ruby`
  - `headlesschrome`, `phantomjs`, `selenium`, `puppeteer`, `playwright`
  - `crawl`, `spider`, `bot` (Google bot 제외)
- User-Agent 없는 요청도 차단
- IP당 분당 120회 Rate Limiting (초과 시 429)
- **[Round 2]** 5초 내 20회 이상 Burst 요청 감지 → 429 (UA 스푸핑해도 차단)
- **[Round 2]** Honeypot 트랩: 숨겨진 링크를 따라간 봇 IP 영구 블랙리스트

### 시나리오 7: Selenium/Puppeteer로 자동화 접근 (Round 2 신규)

```
경쟁사 행동: UA를 정상 브라우저로 위장한 Headless Chrome/Selenium으로 접근
```

**차단 내용:**
- **클라이언트 자동화 감지 (6가지 지표)**:
  - `navigator.webdriver` 속성 체크 (Selenium/WebDriver)
  - `window.__phantom`, `window._phantom` (PhantomJS)
  - `window.__nightmare` (Nightmare.js)
  - UA에 `HeadlessChrome` 포함 여부
  - `navigator.plugins.length === 0` (Headless는 플러그인 0개)
  - `navigator.language` 미설정 (비정상 브라우저)
- 2개 이상 지표 감지 시 → 페이지 내용을 "서비스 점검 중" 화면으로 교체
- **Honeypot 트랩**: 정상 사용자는 절대 안 보이는 숨겨진 링크 5개 배치
  - 봇이 `<a href="/api/trap?src=admin">` 같은 링크를 따라감
  - 해당 IP를 영구 블랙리스트에 등록 → 이후 모든 요청 404

### 시나리오 8: 외부에서 API 직접 호출 (Round 2 신규)

```
경쟁사 행동: Postman/curl로 정상 UA를 위장하여 /api/* 엔드포인트 직접 호출
```

**차단 내용:**
- **Referer/Origin 검증**: API 요청의 referer와 origin이 자사 도메인인지 확인
- 외부 도메인에서 API 직접 호출 시 403 Forbidden
- Rate Limiting + Burst 감지로 대량 요청 차단

### 시나리오 5: AI 도구로 사이트 학습

```
경쟁사 행동: ChatGPT, Claude 등에 사이트 URL을 넣어서 구조 분석
```

**차단 내용:**
- robots.txt에서 AI 크롤러 차단:
  - `GPTBot` (OpenAI)
  - `ChatGPT-User` (OpenAI)
  - `CCBot` (Common Crawl)
  - `anthropic-ai` (Anthropic)
  - `Claude-Web` (Anthropic)
- `/_next/static/` 경로 크롤링 차단

### 시나리오 6: iframe으로 사이트 삽입

```
경쟁사 행동: 자사 사이트에 iframe으로 우리 사이트를 삽입하여 콘텐츠 도용
```

**차단 내용:**
- `X-Frame-Options: DENY` 헤더
- `Content-Security-Policy: frame-ancestors 'none'` 헤더
- 어떤 외부 사이트에서도 iframe으로 삽입 불가

---

## 적용된 보안 파일 목록

| 파일 | 역할 | Round |
|------|------|-------|
| `next.config.mjs` | Source Map 비활성화, 보안 헤더 7종 | R1 |
| `src/components/security/SecurityShield.tsx` | 클라이언트 보안 (우클릭/키보드/복사/DevTools/Console/자동화 감지) | R1+R2 |
| `src/components/security/Honeypot.tsx` | 숨겨진 봇 트랩 링크 5개 | R2 |
| `src/app/api/trap/route.ts` | Honeypot API (봇 IP 블랙리스트 등록) | R2 |
| `src/app/layout.tsx` | SecurityShield + Honeypot 전역 삽입 | R1+R2 |
| `src/middleware.ts` | 서버 보안 (봇 차단, Rate Limiting, Burst 감지, Honeypot 연동, Referer 검증) | R1+R2 |
| `public/robots.txt` | 크롤러/AI봇 접근 제한 | R1 |

---

## 보안 헤더 상세

| 헤더 | 값 | 효과 |
|------|-----|------|
| X-Content-Type-Options | nosniff | MIME 스니핑 공격 방지 |
| X-Frame-Options | DENY | iframe 삽입 차단 |
| X-XSS-Protection | 1; mode=block | XSS 공격 차단 |
| Content-Security-Policy | frame-ancestors 'none' | CSP iframe 차단 |
| Referrer-Policy | strict-origin-when-cross-origin | 리퍼러 정보 최소화 |
| Strict-Transport-Security | max-age=31536000 | HTTPS 강제 (1년) |
| Permissions-Policy | camera=(), microphone=(), geolocation=() | 브라우저 기능 제한 |

---

## 개발 환경 참고

- `SecurityShield`는 `process.env.NODE_ENV !== 'production'`일 때 **작동하지 않음**
- 개발 중에는 F12, 우클릭, 복사 등 모두 정상 사용 가능
- 미들웨어의 봇 차단은 개발 환경에서도 작동 (curl 테스트 시 403)

---

## 향후 추가 보안 계획

### 2단계 (핵심 데이터 서버 이동)
- [ ] 가격 정책 데이터 (`PLANS`, `PRICING_DATA`) → API Route로 이동
- [ ] Server Component 전환 (가격/정책 페이지)
- [ ] API 인증 토큰 적용

### 3단계 (코드 난독화)
- [ ] JavaScript Obfuscator 적용 (변수명/로직 난독화)
- [ ] Tailwind CSS 클래스명 난독화 (`bg-purple-600` → `a3x`)

### 4단계 (법적 보호)
- [ ] 프로그램 저작권 등록 (한국저작권위원회, 3~5만원)
- [ ] "부동산인" 상표 등록 (특허청, 20~30만원)
- [ ] UI 디자인 등록 (특허청, 10~30만원)

---

## Round 2 개선 상세 (OpenAI 분석 기반)

### OpenAI가 지적한 취약점 → 대응

| OpenAI 지적 사항 | 위험도 | 대응 내용 | 상태 |
|------------------|--------|-----------|------|
| JS 비활성화 시 보호 무력화 | 중간 | Next.js SSR로 핵심 데이터 서버 전송 (향후) | 계획 |
| UA 기반 차단 쉽게 우회 | 높음 | Burst 감지 + Honeypot 트랩으로 행동 기반 탐지 | **적용 완료** |
| API 데이터 클라이언트 노출 | 높음 | Referer 검증 추가, RSC 전환 (향후) | 부분 적용 |
| debugger 트랩 성능 이슈 | 중간 | DevTools 감지 시에만 활성화 (2초/5초 간격) | **적용 완료** |
| CSS 클래스명 노출 | 중간 | Tailwind 난독화 (향후) | 계획 |
| Honeypot 링크 부재 | 높음 | 5개 숨겨진 트랩 링크 + IP 블랙리스트 | **적용 완료** |
| 자동화 도구 감지 부재 | 높음 | 6가지 브라우저 핑거프린팅 지표 | **적용 완료** |
| 보안 함수 코드 노출 | 중간 | Function.prototype.toString 재정의 | **적용 완료** |
| input/textarea 복사 불가 | UX | 입력 필드에서 선택/복사 허용으로 변경 | **적용 완료** |

---

## 한계점 (투명한 기록)

| 한계 | 설명 |
|------|------|
| 완전한 차단 불가 | 웹은 본질적으로 클라이언트에 코드를 전송해야 하므로 100% 방어는 불가능 |
| 우회 가능성 | 숙련된 개발자는 브라우저 확장 프로그램이나 프록시로 보안 레이어를 우회할 수 있음 |
| 브라우저 설정 | 사용자가 JavaScript를 비활성화하면 SecurityShield가 작동하지 않음 |
| 메모리 기반 블랙리스트 | Honeypot 블랙리스트는 서버 재시작 시 초기화됨 (프로덕션에서는 Redis/DB 필요) |
| 목적 | 복사 비용을 충분히 높여서 "직접 만드는 게 더 빠르다"고 느끼게 만드는 것이 핵심 전략 |
